<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Content Manager</title>
    <link rel="stylesheet" href="/admin/cms.css" />
  </head>
  <body>
    <script src="https://unpkg.com/netlify-cms@2.10.192/dist/netlify-cms.js"></script>
    <script>
      // Listen for OAuth authentication messages
      window.addEventListener('message', function(event) {
        if (event.data && event.data.token && event.data.provider === 'github') {
          // Store the token for CMS
          localStorage.setItem('netlify-cms-token', event.data.token);
          
          // Initialize CMS with the token
          CMS.init({
            config: {
              backend: {
                name: 'github',
                repo: 'hampusfredrik/blogg',
                branch: 'main',
                token: event.data.token
              }
            }
          });
          
          // Show success message
          document.body.innerHTML = '<div style="padding: 20px; text-align: center;"><h2>Authentication Successful!</h2><p>You are now logged in. Redirecting to CMS...</p></div>';
          
          // Redirect to CMS
          setTimeout(() => {
            window.location.href = '/admin/#/';
          }, 2000);
        }
      });

      // Initialize CMS normally if no token message
      setTimeout(() => {
        if (!localStorage.getItem('netlify-cms-token')) {
          CMS.init();
        }
      }, 1000);
    </script>
  </body>
</html>
