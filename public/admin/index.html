<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TinaCMS Admin</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        margin: 0;
        padding: 20px;
        background: #f5f5f5;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        padding: 40px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      }
      .header {
        text-align: center;
        margin-bottom: 40px;
      }
      .status {
        padding: 15px;
        border-radius: 6px;
        margin: 20px 0;
      }
      .status.success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .status.error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      .status.info {
        background: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }
      .button {
        background: #007cba;
        color: white;
        padding: 12px 24px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        text-decoration: none;
        display: inline-block;
        margin: 10px 5px;
        font-size: 14px;
      }
      .button:hover {
        background: #005a87;
      }
      .loading {
        text-align: center;
        padding: 40px;
      }
      .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #007cba;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
      }
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      #tina-container {
        min-height: 400px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üéâ TinaCMS Admin</h1>
        <p>Content Management for Your Blog</p>
      </div>

      <div id="status-container">
        <div class="status info">
          <strong>üîÑ Loading TinaCMS...</strong><br>
          Please wait while we initialize the content management system.
        </div>
      </div>

      <div id="tina-container">
        <div class="loading">
          <div class="spinner"></div>
          <p>Initializing TinaCMS...</p>
        </div>
      </div>

      <div id="fallback-content" style="display: none;">
        <div class="status error">
          <strong>‚ùå TinaCMS Failed to Load</strong><br>
          There was an issue loading the content management system. You can still manage your content directly on GitHub.
        </div>
        
        <h3>üîß Alternative Content Management:</h3>
        <a href="https://github.com/hampusfredrik/blogg/tree/main/src/content/posts" class="button" target="_blank">
          üìù Edit Posts on GitHub
        </a>
        <a href="https://github.com/hampusfredrik/blogg" class="button" target="_blank">
          üîß Manage Repository
        </a>
        <a href="/" class="button">üè† Back to Blog</a>
      </div>
    </div>

    <script>
      // Debug information
      console.log('Starting TinaCMS initialization...');
      
      // Check if Tina is available
      function checkTinaAvailability() {
        if (typeof Tina === 'undefined') {
          console.error('TinaCMS script failed to load');
          showError('TinaCMS script failed to load. Please check your internet connection and try again.');
          return false;
        }
        console.log('TinaCMS script loaded successfully');
        return true;
      }

      // Show error message
      function showError(message) {
        document.getElementById('status-container').innerHTML = `
          <div class="status error">
            <strong>‚ùå Error:</strong><br>
            ${message}
          </div>
        `;
        document.getElementById('fallback-content').style.display = 'block';
      }

      // Show success message
      function showSuccess(message) {
        document.getElementById('status-container').innerHTML = `
          <div class="status success">
            <strong>‚úÖ Success:</strong><br>
            ${message}
          </div>
        `;
      }

      // Initialize TinaCMS with error handling
      function initializeTina() {
        try {
          console.log('Initializing TinaCMS with config...');
          
          const tinaConfig = {
            isLocalClient: true,
            branch: 'main',
            clientId: '07a73223-b78b-4839-b6df-857ebeeac361',
            token: '6c1ad80e6155f541f657e748b336bcdb88dbc382',
            build: {
              outputFolder: 'admin',
              publicFolder: 'public',
            },
            media: {
              tina: {
                mediaRoot: 'uploads',
                publicFolder: 'public',
              },
            },
            schema: {
              collections: [
                {
                  name: 'post',
                  label: 'Posts',
                  path: 'src/content/posts',
                  format: 'mdx',
                  fields: [
                    {
                      type: 'string',
                      name: 'title',
                      label: 'Title',
                      isTitle: true,
                      required: true,
                    },
                    {
                      type: 'string',
                      name: 'description',
                      label: 'Description',
                      required: true,
                    },
                    {
                      type: 'datetime',
                      name: 'pubDate',
                      label: 'Publish Date',
                      required: true,
                    },
                    {
                      type: 'string',
                      name: 'author',
                      label: 'Author',
                      required: true,
                    },
                    {
                      type: 'rich-text',
                      name: 'body',
                      label: 'Body',
                      isBody: true,
                    },
                  ],
                },
              ],
            },
          };

          console.log('Creating TinaCMS instance...');
          window.tina = new Tina(tinaConfig);
          
          console.log('TinaCMS initialized successfully!');
          showSuccess('TinaCMS loaded successfully! You can now manage your content.');
          
          // Hide loading spinner
          document.getElementById('tina-container').innerHTML = '<div id="root"></div>';
          
        } catch (error) {
          console.error('TinaCMS initialization failed:', error);
          showError(`TinaCMS initialization failed: ${error.message}`);
        }
      }

      // Wait for page to load, then initialize
      document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM loaded, checking TinaCMS availability...');
        
        // Wait a bit for the script to load
        setTimeout(() => {
          if (checkTinaAvailability()) {
            initializeTina();
          }
        }, 1000);
      });

      // Fallback if TinaCMS doesn't load after 10 seconds
      setTimeout(() => {
        if (!window.tina) {
          console.error('TinaCMS failed to load within timeout');
          showError('TinaCMS failed to load. This might be due to network issues or configuration problems.');
        }
      }, 10000);
    </script>

    <!-- Load TinaCMS script with error handling -->
    <script src="https://unpkg.com/@tinacms/tina@^2.9.0/dist/tina.js" 
            onerror="console.error('Failed to load TinaCMS script'); document.getElementById('status-container').innerHTML = '<div class=\'status error\'><strong>‚ùå Script Load Error:</strong><br>Failed to load TinaCMS script. Please check your internet connection.</div>'; document.getElementById('fallback-content').style.display = 'block';">
    </script>
  </body>
</html>